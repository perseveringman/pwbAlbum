var PwbAlbum=function(opts){this.LAYOUT={SQUARE:0,PUZZLE:1,WATERFALL:2,BARREL:3};this.opts=opts||{}};var _option={layout:"",isFullscreen:false,image:[],gutter:0,boxSelector:"",photoSelector:"",cols:4,minH:100,maxH:300,minNum:3,maxNum:6,size:100};PwbAlbum.prototype.setPuzzle=function(){var $boxes=this.getImageDomElements();var $parent=this.getParentDomElements();$parent.css("height","500px");if($boxes.length>6){alert("The PUZZLE only can include six pictures!");_option.layout="SQUARE";this.setLayout(_option.layout);return}$boxes.removeClass();$boxes.addClass("photoBox");$boxes.addClass("photo_"+$boxes.length)};PwbAlbum.prototype.setSquare=function(){var $boxes=this.getImageDomElements();$boxes.removeClass();$boxes.addClass("photoBox");$boxes.addClass("square");$boxes.css("width",_option.size+"px").css("height",_option.size+"px")};PwbAlbum.prototype.setWaterFall=function(){var $parent=this.getParentDomElements();var $boxes=this.getImageDomElements();$boxes.removeClass();$boxes.addClass("photoBox waterfall");var cols=_option.cols;var parentW=$parent.width();var boxW=parentW/cols;$boxes.css("width",boxW).css("height","auto");var hArr=[];var getIndex=function(arr,val){for(var i=0;i<arr.length;i++){if(arr[i]==val){return i}}};$boxes.each(function(n,ele){if(n<cols){hArr.push($(ele).outerHeight())}else{var getminH=Math.min.apply(null,hArr);var index=getIndex(hArr,getminH);var left=index*boxW+"px";$(ele).css("position","absolute").css("top",getminH+"px").css("left",left);hArr[index]+=$(ele).outerHeight()}})};PwbAlbum.prototype.setBarrel=function(){var self=this;var $boxes=this.getImageDomElements();var $parent=this.getParentDomElements();$boxes.removeClass();$boxes.addClass("photoBox");var parentW=$parent.width()-10;var maxRatio=parentW/_option.minH;var minRatio=parentW/_option.maxH;var tempBox=[];var tempRatio=0;var rowHeight;$boxes.each(function(n,ele){var boxRatio=$(ele).outerWidth()/$(ele).outerHeight();if(tempBox.length>=_option.minNum&&tempRatio>minRatio){rowHeight=parentW/tempRatio;
self.barrelNewLine(tempBox,rowHeight);tempBox=[];tempRatio=0}tempBox.push($(ele));tempRatio+=boxRatio});if(tempBox.length){if(tempRatio>minRatio){rowHeight=parentW/tempRatio;self.barrelNewLine(tempBox,rowHeight)}else{rowHeight=(_option.minH+_option.maxH)/2;self.barrelNewLine(tempBox,rowHeight)}tempBox=[];tempRatio=0}};PwbAlbum.prototype.barrelNewLine=function(boxes,rowHeight){var $parent=this.getParentDomElements();var boxW;var boxGutter=2*_option.gutter;var rowH=rowHeight-boxGutter;$parent.addClass("clear");for(var i=0;i<boxes.length;i++){boxW=(boxes[i].width()*rowH/boxes[i].height());boxes[i].css("height",rowH).css("width",boxW).css("float","left");$parent.append(boxes[i])}};PwbAlbum.prototype.setImage=function(image,opts){if(typeof image==="string"){this.setImage([image]);return}$parent=this.getParentDomElements();$parent.empty();var self=this;var flag=true;_option.layout=opts.layout;_option.gutter=opts.gutter;_option.isFullscreen=opts.isFullscreen;_option.cols=opts.cols;_option.minH=opts.minH;_option.maxH=opts.maxH;_option.maxNum=opts.maxNum;_option.minNum=opts.minNum;_option.image=opts.images;_option.size=opts.size;this.addImage(image);$(window).load(function(){self.setLayout(self.getLayout());flag=false});if(flag){self.setLayout(self.getLayout())}if(_option.isFullscreen){self.enableFullscreen(_option.image)}else{self.disableFullscreen()}};PwbAlbum.prototype.getParentDomElements=function(){var boxSelector=this.opts.boxSelector||"#puzzleContainer";var $parent=$("#"+boxSelector);return $parent};PwbAlbum.prototype.getImageDomElements=function(){var boxSelector=this.opts.boxSelector||"puzzleContainer";var photoSelector=this.opts.photoSelector||"photoBox";var $boxes=$("#"+boxSelector+" ."+photoSelector);return $boxes};PwbAlbum.prototype.addImage=function(image){if(typeof image==="string"){this.addImage([image]);return}var self=this;var $parent=this.getParentDomElements();for(var i=0;i<image.length;i++){$parent.append("<div class='photoBox'><img src="+image[i]+".jpg></div>")
}$(window).load(function(){self.setLayout(self.getLayout())});if(image.length==1){self.setLayout(self.getLayout())}};PwbAlbum.prototype.removeImage=function(image){};PwbAlbum.prototype.setLayout=function(layout){this.setGutter(this.opts.gutter);switch(this.getLayout()){case 0:this.setSquare();break;case 1:this.setPuzzle();break;case 2:this.setWaterFall();break;case 3:this.setBarrel();break;default:break}};PwbAlbum.prototype.getLayout=function(){return this.LAYOUT[_option.layout]};PwbAlbum.prototype.setGutter=function(gutter){var $boxes=this.getImageDomElements();$boxes.css("border-width",gutter+"px").css("border-style","solid").css("border-color","transparent")};PwbAlbum.prototype.enableFullscreen=function(image){$("img").click(function(event){var tg=event.target;var url=$(tg).attr("src");var index;for(var i=0;i<image.length;i++){if(image[i]+".jpg"==url){index=i;break}}$(".fullPicture").attr("src",url);$(".fullscreen").css("display","block");$("#next").click(function(){if(image[index]==image[index+1]){return}$(".fullPicture").attr("src",image[++index])});$("#prev").click(function(){if(image[index]==image[index-1]){return}$(".fullPicture").attr("src",image[--index])});$(".fullscreen").click(function(event){if(event.target!=$("#prev")[0]&&event.target!=$("#next")[0]){$(".fullscreen").css("display","none")}})})};PwbAlbum.prototype.disableFullscreen=function(){};PwbAlbum.prototype.isFullscreenEnabled=function(){};PwbAlbum.prototype.setBarrelBin=function(min,max){if(min===undefined||max===undefined||min>max){console.error("...");return}};PwbAlbum.prototype.getBarrelBinMax=function(){};PwbAlbum.prototype.getBarrelBinMin=function(){};PwbAlbum.prototype.setBarrelHeight=function(min,max){};PwbAlbum.prototype.getBarrelHeightMax=function(){};PwbAlbum.prototype.getBarrelHeightMin=function(){};
function getRandomImg(argument){var randomColor=("00000"+(Math.random()*16777216<<0).toString(16)).slice(-6);var pWidth=Math.floor((Math.random()*6+2)*100);var randomSize=Math.floor((Math.random()*6+2)*100)+"X"+Math.floor((Math.random()*5+2)*100);var src="http://placehold.it/"+randomSize+"/"+randomColor+"/fff";return src}var imgs=[];for(var i=0;i<2;i++){imgs.push(getRandomImg())}var options={layout:"SQUARE",isFullscreen:true,images:[],gutter:0,boxSelector:"puzzleContainer",photoSelector:"photoBox",cols:4,minH:200,maxH:400,minNum:3,maxNum:6,size:100};options.images=imgs;var pwbAlbum=new PwbAlbum(options);pwbAlbum.setImage(imgs,options);$("#fullscreen").change(function(){options.isFullscreen=$(this).val();pwbAlbum.setImage(imgs,options)});$("#addImage").click(function(){var url=$("#imgUrl").val();options.images.push(url);pwbAlbum.setImage(imgs,options);$("#imgUrl").val(getRandomImg());if(imgs.length>6&&options.layout=="PUZZLE"){$("#square").click()}});$("#Cols").change(function(){options.cols=$(this).val();pwbAlbum.setImage(imgs,options)});$("#square").click(function(){$(".gutterGroup").show();$("#albumType li").removeClass("active");$(this).addClass("active");$(".layoutConfigure").hide();$("#conSquare").show();options.layout="SQUARE";pwbAlbum.setImage(imgs,options)});$("#puzzle").click(function(){$(".gutterGroup").show();$("#albumType li").removeClass("active");$(this).addClass("active");$(".layoutConfigure").hide();$("#conPuzzle").show();options.layout="PUZZLE";if(imgs.length>6){alert("The PUZZLE only can include six pictures!");$("#square").click()}pwbAlbum.setImage(imgs,options)});$("#waterfall").click(function(){$(".gutterGroup").show();$("#albumType li").removeClass("active");$(this).addClass("active");$(".layoutConfigure").hide();$("#conWaterfall").show();options.layout="WATERFALL";pwbAlbum.setImage(imgs,options)});$("#barrel").click(function(){$("#albumType li").removeClass("active");$(this).addClass("active");$(".layoutConfigure").hide();$("#gutter").val(0);$(".gutterGroup").hide();
$("#conBarrel").show();options.layout="BARREL";options.gutter=$("#gutter").val();pwbAlbum.setImage(imgs,options)});$("#gutter").change(function(){if($(this).val()>50){alert("??????50?");$(this).val(50)}else{if($(this).val()<0){alert("??????0?");$(this).val(0)}}options.gutter=$(this).val();pwbAlbum.setImage(imgs,options)});$("#maxH").change(function(){if($(this).val()>400){alert("??????400?");$(this).val(400)}else{if($(this).val()<200){alert("??????200?");$(this).val(200)}}options.maxH=$(this).val();pwbAlbum.setImage(imgs,options)});$("#minNum").change(function(){if($(this).val()>6){alert("??????6?");$(this).val(6)}else{if($(this).val()<3){alert("??????3?");$(this).val(3)}}options.minNum=$(this).val();pwbAlbum.setImage(imgs,options)});$("#size").change(function(){if($(this).val()>300){alert("??????300?");$(this).val(300)}else{if($(this).val()<50){alert("??????50?");$(this).val(50)}}options.size=$(this).val();pwbAlbum.setImage(imgs,options)});$("#imgUrl").val(getRandomImg());
